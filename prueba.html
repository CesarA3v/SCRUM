<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clima en Ciudad</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f0f0f0;
        }
        #app {
            max-width: 500px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        h1 {
            text-align: center;
        }
        input, button {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        .result {
            margin-top: 20px;
        }
        .result p {
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <div id="app">
        <h1>Consulta del Clima</h1>
        <input type="text" id="city" placeholder="Ingresa una ciudad (Ej: Londres)">
        <button onclick="getWeather()">Obtener Clima</button>
        <button onclick="getWeatherByLocation()">Clima por Ubicación Actual</button>
        
        <div class="result" id="weatherResult"></div>
    </div>

    <script>
        const apiKey = '07cc062654msh6d1767deeb29807p15fa79jsn3d16f53f420f'; // Tu clave API de RapidAPI

        // Función para obtener el clima de una ciudad
        function getWeather() {
            const city = document.getElementById("city").value;
            if (!city) {
                alert("Por favor ingresa una ciudad.");
                return;
            }

            // URL de la API de RapidAPI para OpenWeather sin especificar unidades (por defecto en Fahrenheit)
            const url = `https://open-weather13.p.rapidapi.com/city/${city}/EN`;

            // Opciones para la solicitud con los encabezados necesarios
            const options = {
                method: 'GET',
                headers: {
                    'x-rapidapi-host': 'open-weather13.p.rapidapi.com',
                    'x-rapidapi-key': apiKey
                }
            };

            // Realizar la solicitud
            fetch(url, options)
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        document.getElementById("weatherResult").innerHTML = `<p>No se encontraron datos. Intenta de nuevo.</p>`;
                    } else {
                        // Procesar los datos
                        const weather = data.main;
                        const weatherCondition = data.weather[0];
                        const wind = data.wind;
                        const rain = data.rain ? data.rain['1h'] : 0; // Precipitación en la última hora
                        const visibility = data.visibility / 1000; // Convertir de metros a kilómetros
                        const dewPoint = weather.temp - ((100 - weather.humidity) / 5); // Estimación del punto de rocío

                        // Convertir la temperatura de Fahrenheit a Celsius (hardcodeado)
                        const tempCelsius = fahrenheitToCelsius(weather.temp); 

                        // Traducir la descripción del clima (condición)
                        const translatedCondition = translateCondition(weatherCondition.description);

                        document.getElementById("weatherResult").innerHTML = `
                            <h3>${data.name}, ${data.sys.country}</h3>
                            <p><strong>Condición:</strong> ${translatedCondition}</p>
                            <p><strong>Temperatura:</strong> ${tempCelsius} °C</p>
                            <p><strong>Humedad:</strong> ${weather.humidity}%</p>
                            <p><strong>Viento:</strong> ${wind.speed} m/s</p>
                            <p><strong>Presión atmosférica:</strong> ${weather.pressure} hPa</p>
                            <p><strong>Visibilidad:</strong> ${visibility} km</p>
                            <p><strong>Precipitación:</strong> ${rain} mm</p>
                            <p><strong>Punto de rocío:</strong> ${dewPoint.toFixed(2)} °C</p>
                        `;
                    }
                })
                .catch(err => {
                    document.getElementById("weatherResult").innerHTML = `<p>Hubo un error al obtener los datos. Intenta de nuevo más tarde.</p>`;
                    console.error(err);
                });
        }

        // Función para obtener el clima basado en la ubicación actual
        function getWeatherByLocation() {
            if (!navigator.geolocation) {
                alert("La geolocalización no es compatible con tu navegador.");
                return;
            }

            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const { latitude, longitude } = position.coords;

                    // URL de la API de RapidAPI para OpenWeather usando latitud y longitud
                    const url = `https://open-weather13.p.rapidapi.com/weather?lat=${latitude}&lon=${longitude}&appid=${apiKey}`;

                    const options = {
                        method: 'GET',
                        headers: {
                            'x-rapidapi-host': 'open-weather13.p.rapidapi.com',
                            'x-rapidapi-key': apiKey
                        }
                    };

                    // Realizar la solicitud
                    fetch(url, options)
                        .then(response => response.json())
                        .then(data => {
                            if (data.error) {
                                document.getElementById("weatherResult").innerHTML = `<p>No se encontraron datos. Intenta de nuevo.</p>`;
                            } else {
                                // Procesar los datos
                                const weather = data.main;
                                const weatherCondition = data.weather[0];
                                const wind = data.wind;
                                const rain = data.rain ? data.rain['1h'] : 0;
                                const visibility = data.visibility / 1000;
                                const dewPoint = weather.temp - ((100 - weather.humidity) / 5);

                                // Convertir la temperatura de Fahrenheit a Celsius (hardcodeado)
                                const tempCelsius = fahrenheitToCelsius(weather.temp);

                                const translatedCondition = translateCondition(weatherCondition.description);

                                document.getElementById("weatherResult").innerHTML = `
                                    <h3>${data.name}, ${data.sys.country}</h3>
                                    <p><strong>Condición:</strong> ${translatedCondition}</p>
                                    <p><strong>Temperatura:</strong> ${tempCelsius} °C</p>
                                    <p><strong>Humedad:</strong> ${weather.humidity}%</p>
                                    <p><strong>Viento:</strong> ${wind.speed} m/s</p>
                                    <p><strong>Presión atmosférica:</strong> ${weather.pressure} hPa</p>
                                    <p><strong>Visibilidad:</strong> ${visibility} km</p>
                                    <p><strong>Precipitación:</strong> ${rain} mm</p>
                                    <p><strong>Punto de rocío:</strong> ${dewPoint.toFixed(2)} °C</p>
                                `;
                            }
                        })
                        .catch(err => {
                            document.getElementById("weatherResult").innerHTML = `<p>Hubo un error al obtener los datos. Intenta de nuevo más tarde.</p>`;
                            console.error(err);
                        });
                },
                (error) => {
                    alert("No se pudo obtener la ubicación. Por favor, intenta de nuevo.");
                    console.error(error);
                }
            );
        }

        // Función para convertir la temperatura de Fahrenheit a Celsius
        function fahrenheitToCelsius(fahrenheit) {
            return ((fahrenheit - 32) * 5/9).toFixed(2);  // Redondeado a 2 decimales
        }

        // Función para traducir las condiciones del clima
        function translateCondition(condition) {
            const translations = {
                "clear sky": "cielo despejado",
                "few clouds": "pocas nubes",
                "scattered clouds": "nubes dispersas",
                "broken clouds": "nubes rotas",
                "shower rain": "lluvia de ducha",
                "rain": "lluvia",
                "thunderstorm": "tormenta eléctrica",
                "snow": "nieve",
                "mist": "neblina",
                "drizzle": "llovizna",
                "overcast clouds": "nubes cubiertas"
            };

            return translations[condition] || condition;  // Devuelve la descripción traducida o la original
        }
    </script>
</body>
</html>
